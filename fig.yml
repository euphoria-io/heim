psqldata:
  build: containers/psql/data

psql:
  build: containers/psql
  volumes:
    - psqldata/data:/var/lib/postgresql/data

psqlclient:
  command: psql -h psql -p 5432 -U postgres heim
  build: containers/psql/client
  links:
    - psql

upgradedb:
  build: backend/upgradedb
  links:
    - psql
  volumes:
    - backend:/go/src/heim/backend

frontend:
  command: gulp build
  build: client
  volumes:
    - client:/srv/heim/client/src
    - backend/static:/srv/heim/client/src/build
  environment:
    NODE_ENV: production

backend:
  build: backend
  links:
    - psql
  volumes:
    - backend:/go/src/heim/backend

heim:
  build: containers/heim
  links:
    - psql
  ports:
    - "2222:22"
  volumes:
    - ${GOPATH}/bin/heim-backend:/hzp/backend.hzp

haproxy:
  build: containers/haproxy
  links:
    - backend:dev1
  ports:
    - "8080:80"
